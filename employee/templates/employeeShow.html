{% extends "employee.html" %}
{% load static %}

{% block title %}
  Liste des employes
{% endblock title %}

{% block css %}
<style>
  input{
    width: 100%;
  }
</style>
{% endblock %}
{% block main %}
    <div class="row">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header card-header-primary">
              <h4 class="card-title">Editer Profile</h4>
              <p class="card-category">Completer le profile de {{ employee.first_name }} {{ employee.last_name }}</p>
            </div>
            <div class="card-body">
              <form>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label class="bmd-label-floating">Enregistre Le</label>
                      <input type="text" class="form-control" disabled value="{{ employee.created_at }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Prenom</label>
                      <input type="text" class="form-control" value="{{ employee.first_name }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Nom</label>
                      <input type="text" class="form-control" disabled value="{{ employee.last_name }}">
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <label class="bmd-label-floating">Sexe</label>
                      <input type="text" class="form-control" disabled value="{{ employee.last_name }}">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">CNI</label>
                      <input type="text" class="form-control" disabled value="{{ employee.cni }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Email</label>
                      <input type="text" class="form-control" value="{{ employee.email }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Tel</label>
                      <input type="text" class="form-control" disabled value="{{ employee.tel }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Fix</label>
                      <input type="text" class="form-control" disabled value="{{ employee.fix }}">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Adresse</label>
                      <input type="text" class="form-control" disabled value="{{ employee.adress }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Date de naissance</label>
                      <input type="text" class="form-control" value="{{ employee.birth_date }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Lieu de naissance</label>
                      <input type="text" class="form-control" disabled value="{{ employee.birth_to }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Matricule</label>
                      <input type="text" class="form-control" disabled value="{{ employee.regis_number }}">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Statut matrimonial</label>
                      <input type="text" class="form-control" disabled value="{{ employee.marital_status }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Nombre d'enfant</label>
                      <input type="text" class="form-control" value="{{ employee.number_children }}">
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="form-group">
                      <label class="bmd-label-floating">Numero de securité Social</label>
                      <input type="text" class="form-control" disabled value="{{ employee.social_security_number }}">
                    </div>
                  </div>
                </div>
                <div class="clearfix"></div>
              </form>
              <a class="btn btn-primary pull-right" href=" {% url 'employeeEdit' employee.id %} ">Editer Profile</a>
            </div>
          </div>

          <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title">Contrats</h4>
                  <p class="card-category"></p>
                </div>
                <div class="card-body">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                        Ajouter un contrat 
                    </button>
  
                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Ajoute de contrat</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form enctype="multipart/form-data" action="{% url 'contractAdd' employee.id %}" method="post">
                                        {% csrf_token %}
                                        <table class="table">
                                            {{ form.as_table }}
                                            <tr>
                                                <th></th>
                                                <td><input type="hidden" value="{{ employee.id }}" name="employees" required id="id_employees"></td>
                                            </tr>
                                        </table>
                                        <input type="submit" value="Submit" class="btn btn-primary customback"/>
                                    </form>
                                </div> <!--
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div> -->
                            </div>
                        </div>
                    </div>
                    {% for ctr in employee.contract_set.all  %}
                    <div class="table-contract">
                        <table class="table">
                            <tbody>
                                <tr><th>Debut-Fin</th><td> {{ ctr.begin }} au {{ ctr.end }} </td></tr>
                                <tr><th>Type</th><td> {{ ctr.contract_type }} </td></tr>
                                <tr><th>Salaire</th><td> {{ ctr.salary }} </td></tr>
                                <tr>
                                    <th>Poste</th>
                                    <td>
                                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                                            <span class="badge badge-pill">ouvrir</span>
                                        </button>
                                        <!-- Modal -->
                                        <div id="myModal" class="modal fade" role="dialog">
                                            <div class="modal-dialog modal-lg">
                                                <embed class="modal-content" id="textDoc" src="{{ ctr.contract_doc.url }}" width='900' height='600' type='application/pdf'/>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    {% endfor %}
                </div>
          </div>
          <div class="card">
              <div class="card-header card-header-primary">
                <h4 class="card-title">Bulletin de Salaire</h4>
                <p class="card-category"></p>
              </div>
              <div class="card-body">
                  <a class="btn btn-primary" style="color: #fff;" href="{% url 'addSalary' employee.id  %}">Ajouter Bulletin</a>

                  {% for sal in salarys %}
                      <div class="table-contract">
                          <table class="table">
                              <tbody>
                                  <tr><th>Bulletin du mois </th><td> {{ sal.salary_period }} </td></tr>
                                  <tr>
                                      <th>Creer le </th>
                                      <td> 
                                          {{ sal.created_at }}
                                      </td>
                                  </tr>
                                  <tr>
                                      <td colspan="2">
                                          <a href="{% url 'addSalary' employee.id sal.id %}" style="margin-left: 15px;" class="customback btn btn-primary"><span class="badge badge-pill">Ouvrir</span></a>  
                                          <a href="#" style="margin-left: 15px;" class="customback btn btn-primary "><span class="badge badge-pill">Imprimer</span></a>  
                                          <a href="{% url 'duplicateSalary' employee.id sal.id %}" style="margin-left: 15px;" class="confdel customback btn btn-primary "><span class="badge badge-pill">Dupliquer</span></a> 
                                          {% if sal.closed == False %}
                                          <a href=" {% url 'delSalary' employee.id sal.id %} " style="margin-left: 15px;" class="confdel customback btn btn-primary "><span class="badge badge-pill">Supprimer</span></a>  
                                          <a href="{% url 'closeSalary' employee.id sal.id %}" style="margin-left: 15px;" class="confdel customback btn btn-primary "><span class="badge badge-pill">Payer</span></a>  
                                          {% endif %}
                                      </td>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                  {% endfor %}
              </div>
          </div>
          <div class="card">
              <div class="card-header card-header-primary">
                <h4 class="card-title">Mini CV</h4>
                <p class="card-category"></p>
              </div>
              <div class="card-body">
                  <h4 class="customcolor">Experiences Profetionnelles</h4>
                                    <table class="table">
                                        <tr class="customcolor">
                                            <th> Structure </th> 
                                            <th> poste </th>
                                            <th> Debut </th>
                                            <th> Fin </th>
                                            <th> Description </th>
                                            <th>#</th>
                                        </tr>
                                        {% for exp in employee.professionalexperience_set.all  %}
                                        <tr>
                                            <th> {{ exp.structure }} </th> 
                                            <td> {{ exp.post }} </td>
                                            <td> {{ exp.begin }} </td>
                                            <td> {{ exp.end }} </td>
                                            <td> {{ exp.desc }} </td>
                                            <td>#</td>
                                        </tr>
                                        {% endfor %}
                                    </table>
                                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#expadd">
                                    ajouter une experience
                                    </button>
                                    <!-- Modal -->
                                    <div class="modal fade" id="expadd" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Ajouter une experience</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <form action="{% url 'experienceAdd' employee.id %}" method="post">
                                                    {% csrf_token %}
                                                <table class="table">
                                                    <tr><th>Structure </th> <td>{{ formExperience.structure }}</td></tr>
                                                    <tr><th>Poste </th><td>{{ formExperience.post }}</td></tr>
                                                    <tr><th>Debut </th><td> {{ formExperience.begin }} </td></tr>
                                                    <tr><th>Fin</th><td> {{ formExperience.end }} </td></tr>
                                                    <tr><th>Description</th><td> {{ formExperience.desc }} </td></tr>
                                                    <input type="hidden" value="{{employee.id}}" id="id_employee" name="employee" required >
                                                    <tr>
                                                        <th>Valider</th>
                                                        <td> <input type="submit" value="Submit" class="btn btn-primary customback"/></td>
                                                    </tr> 
                                                </table>
                                                </form>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h4 class="customcolor">Diplomes</h4>
                                    <table class="table">
                                        <tr class="customcolor">
                                            <th> Nom Diplome </th> 
                                            <th> Ecole </th>
                                            <th> Année </th>
                                            <th>#</th>
                                        </tr>
                                        {% for dip in employee.diploma_set.all  %}
                                        <tr>
                                            <th> {{ dip.label }} </th> 
                                            <td> {{ dip.school }} </td>
                                            <td> {{ dip.year }} </td>
                                            <td>#</td>
                                        </tr>
                                        {% endfor %}
                                        <form action="{% url 'diplomaAdd' employee.id %}" method="post">
                                            {% csrf_token %}
                                            <tr>
                                                <th> {{ formDiploma.label }} </th>
                                                <th> {{ formDiploma.school }} </th>
                                                <th> {{ formDiploma.year }} </th>
                                                <th>
                                                    <input type="hidden" value="{{employee.id}}" id="id_employee" name="employee" required >
                                                    <input type="submit" value="Submit" class="btn btn-primary customback"/>
                                                </th>
                                            </tr>
                                        </form>
                                    </table>
              </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card card-profile">
            <div class="card-avatar">
              <a href="#pablo">
                <img class="img" src="{{ employee.profil_img.url }}" />
              </a>
            </div>
            <div class="card-body">
                <h6 class="card-category text-gray">
                    {% if curent_contract != None %}
                        {{ curent_contract.post.label }}
                    {% else %}
                        pas de contrat en cours 
                    {% endif %}
                </h6>
                <h4 class="card-title">{{ employee.first_name }} {{ employee.last_name }}</h4>
                <p class="card-description">
                    <p>Diplome</p>
                    {% for dip in employee.diploma_set.all  %}
                      <a href="#"> {{ dip.label }} </a><br/>
                    {% endfor %}
                    <hr>
                    <p>Experiences</p>
                    {% for exp in employee.professionalexperience_set.all %}
                      <a href="#"> {{ exp.structure }} </a><br/>
                    {% endfor %}
                </p>
            </div>
          </div>
        </div>
      </div>
{% endblock main %}

{% block js %}
    <script>
        console.log("okk") ;
        $('#id_begin').attr('type', 'date')
        $('#id_end').attr('type', 'date')
        $('#id_employees').attr('disabled', 'desabled')
        $('#id_employees').parent().parent().remove()
        $('.confdel').click(function(){
            if (confirm("etes vous sur de vouloir effectuer cet action ?")) {
                return true
            }else{
                return false
            }
        })
    </script>
{% endblock js %}